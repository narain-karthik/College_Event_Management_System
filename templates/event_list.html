{% extends "layout.html" %}
{% block title %}Events{% endblock %}
{% block content %}
<div class="page-header">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
    <div>
      <h1><i class="bi bi-grid me-2"></i>All Events</h1>
      <p>Discover and book exciting events happening at your college</p>
    </div>
    <form method="get" class="d-flex gap-2">
      <select name="category" class="form-select">
        <option value="">All Categories</option>
        {% for c in categories %}
          <option value="{{ c.name }}" {% if request.args.get('category')==c.name %}selected{% endif %}>{{ c.name }}</option>
        {% endfor %}
      </select>
      <button class="btn btn-primary"><i class="bi bi-funnel me-1"></i>Filter</button>
    </form>
  </div>
</div>

{% if events %}
  <div class="row">
    {% for e in events %}
      <div class="col-md-4 mb-4">
        <div class="event-card card h-100 fade-in">
          {% if e.poster_path %}
            <img src="{{ url_for('serve_upload', filename=e.poster_path.split('/')[-1]) }}" class="card-img-top" alt="{{ e.title }}">
          {% else %}
            <div class="card-img-top d-flex align-items-center justify-content-center" style="height:180px; background: linear-gradient(135deg, #dbeafe 0%, #ede9fe 100%);">
              <i class="bi bi-calendar-event text-primary" style="font-size: 3rem; opacity: 0.5;"></i>
            </div>
          {% endif %}
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h5 class="event-title mb-0">{{ e.title }}</h5>
              {% if e.status == 'approved' %}
                <span class="badge bg-success">Open</span>
              {% elif e.status == 'pending' %}
                <span class="badge bg-warning">Pending</span>
              {% else %}
                <span class="badge bg-secondary">{{ e.status }}</span>
              {% endif %}
            </div>
            <div class="event-meta"><i class="bi bi-calendar3"></i> {{ e.start_time.strftime('%B %d, %Y') }}</div>
            <div class="event-meta"><i class="bi bi-clock"></i> {{ e.start_time.strftime('%I:%M %p') }}</div>
            <div class="event-meta"><i class="bi bi-geo-alt"></i> {{ e.hall.name if e.hall else 'TBD' }}</div>
            {% if e.category %}
              <span class="badge bg-primary mt-2 align-self-start">{{ e.category.name }}</span>
            {% endif %}
            <p class="small text-muted mt-2 mb-0">{{ (e.description or '')[:80] }}{% if e.description and e.description|length > 80 %}...{% endif %}</p>
            <div class="mt-auto pt-3">
              <a href="{{ url_for('event_detail', event_id=e.id) }}" class="btn btn-primary w-100">
                <i class="bi bi-eye me-1"></i>View Details
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="empty-state">
    <div class="empty-state-icon"><i class="bi bi-calendar-x"></i></div>
    <h3>No Events Found</h3>
    <p>Try adjusting your filter or check back later for new events!</p>
  </div>
{% endif %}
{% endblock %}
