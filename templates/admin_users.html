{% extends "layout.html" %}
{% block title %}Manage Users{% endblock %}
{% block content %}
<div class="page-header">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
    <div>
      <h1><i class="bi bi-people me-2"></i>Manage Users</h1>
      <p>Create and manage user accounts and permissions</p>
    </div>
    <a class="btn btn-outline-secondary" href="{{ url_for('admin_dashboard') }}">
      <i class="bi bi-arrow-left me-1"></i>Back to Dashboard
    </a>
  </div>
</div>

<div class="row">
  <div class="col-lg-4 mb-4">
    <div class="dashboard-section">
      <h3><i class="bi bi-person-plus me-2"></i>Create New User</h3>
      <form method="post" action="{{ url_for('admin_users') }}">
        <div class="mb-3">
          <label class="form-label">Email <span class="text-danger">*</span></label>
          <input name="email" class="form-control" placeholder="user@example.com" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Full Name</label>
          <input name="full_name" class="form-control" placeholder="John Doe">
        </div>
        <div class="mb-3">
          <label class="form-label">Role</label>
          <select name="role" class="form-select">
            <option value="student" selected>Student</option>
            <option value="faculty">Faculty</option>
            <option value="organizer">Event Organizer</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Password</label>
          <input name="password" type="password" class="form-control" placeholder="Set password">
          <div class="form-text">Leave blank for default password</div>
        </div>
        <button class="btn btn-primary w-100" type="submit">
          <i class="bi bi-person-plus me-1"></i>Create User
        </button>
      </form>
    </div>
  </div>

  <div class="col-lg-8 mb-4">
    <div class="dashboard-section">
      <h3><i class="bi bi-list-ul me-2"></i>All Users</h3>
      <div class="table-responsive">
        <table class="table mb-0">
          <thead>
            <tr>
              <th>User</th>
              <th>Role</th>
              <th>Status</th>
              <th>Created</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
              <tr>
                <td>
                  <div><strong>{{ u.full_name or 'N/A' }}</strong></div>
                  <div class="small text-muted">{{ u.email }}{% if u.student_id %} â€¢ {{ u.student_id }}{% endif %}</div>
                </td>
                <td>
                  <form method="post" action="{{ url_for('admin_update_user', user_id=u.id) }}" class="d-flex gap-2 align-items-center" id="form-{{ u.id }}">
                    <select name="role" class="form-select form-select-sm" style="width: 130px;">
                      <option value="student" {% if u.role=='student' %}selected{% endif %}>Student</option>
                      <option value="faculty" {% if u.role=='faculty' %}selected{% endif %}>Faculty</option>
                      <option value="organizer" {% if u.role=='organizer' %}selected{% endif %}>Organizer</option>
                      <option value="admin" {% if u.role=='admin' %}selected{% endif %}>Admin</option>
                    </select>
                </td>
                <td>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" name="active" value="1" id="active-{{ u.id }}" {% if u.active %}checked{% endif %}>
                      <label class="form-check-label small" for="active-{{ u.id }}">Active</label>
                    </div>
                </td>
                <td class="small text-muted">{{ u.created_at.strftime('%b %d, %Y') if u.created_at else 'N/A' }}</td>
                <td class="text-end">
                    <button class="btn btn-sm btn-primary" type="submit">
                      <i class="bi bi-check-lg"></i>
                    </button>
                  </form>
                </td>
              </tr>
            {% else %}
              <tr><td colspan="5" class="text-center text-muted py-4">No users found</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
